<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <style>
    @import url(https://fonts.googleapis.com/css?family=Poiret+One);
    @import url(https://cdnjs.cloudflare.com/ajax/libs/weather-icons/2.0.9/css/weather-icons.min.css);
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@100;300;400;500;600;700;800;900&display=swap');

    body{
      margin: 0;
      padding: 0;
      background-color: rgb(34, 34, 34);
      
    }

    /* typing animation */
    .wrapper {
      height: 10vh;
      /*This part is important for centering*/
      display: grid;
      place-items: center;
      background-color: #fff;
      color: rgb(62, 62, 62);
    }

    .typing-demo {
      width: 18ch;
      animation: typing 2s steps(18), blink .5s step-end infinite alternate;
      white-space: nowrap;
      overflow: hidden;
      border-right: 3px solid;
      font-family: monospace;
      font-size: 2em;
    }

    @keyframes typing {
      from {
        width: 0
      }
    }
        
    @keyframes blink {
      50% {
        border-color: transparent
      }
    }

    /* profile */
    :root {
    --fir-font-article: "adobe-garamond-pro", "Times New Roman", Times;
      --fir-font-header: "foco", Helvetica;
      --fir-blue-twitter-alpha: rgba(85,172,238, 0.6);
      --fir-color-grey: #fff;
    }

    .fir-clickcircle {
      height: 80px;
      width: 80px;
      border-radius: 100px;
      cursor: pointer;
    }

    .fir-image-figure {
      margin: 0;
      display: flex;
      align-items: center;
      margin-bottom: 40px;
      position: relative;
      text-decoration: none;
      justify-content: center; 
      margin-top: 20px;
    }

    .fir-image-figure .caption, .fir-image-figure figcaption {
      padding-left: 15px;
    }

    html.wf-active .fir-image-figure .fig-author-figure-title {
      font-family: var(--fir-font-header);
      font-size: 16px;
    }

    .fir-image-figure .fig-author-figure-title {
      color: var(--fir-color-grey);
      font-family: "HelveticaNeue-Light", "Helvetica Neue Light", "Helvetica Neue", Helvetica, Arial, "Lucida Grande", sans-serif;
      font-weight: 400;
      font-size: 18px;
      margin-top: 2px;
      padding: 5px;
    }

    .fir-imageover {
      position: relative;
      display: flex;
    }

    .fir-imageover-color {
      height: 80px;
      width: 80px;
      position: absolute;
      background: var(--fir-blue-twitter-alpha);
      background-image: none;
      border-radius: 100px;
      cursor: pointer;
      transition: background .5s ease-in-out;
      animation: fadeInFadeOut 4s infinite;
      top: 0;
      left: 0;
    }

    .fir-imageover-image {
      position: absolute;
      top: 0;
      left: 0;
      animation: fadeInFadeOut 4s infinite;
    }

    @keyframes fadeInFadeOut {
      0%   { opacity:1; }
      50%  { opacity:0; }
      100% { opacity:1; }
    }

    /* widgte cuaca */
    .boxWeather {
        background-color: #2a2a2a;
        padding: 10px 20px;
        border-radius: 10px;
        display: flex;
        justify-content: center;
        text-align: center;
        width: 330px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
        cursor: pointer;
        margin: 20px auto; /* Tengah secara horizontal */
    }

    .weatherIcon{
        height: 60%;
        color: #fafafa;
        font-family: weathericons;
        font-size: 100px;
    }
    .weather {
      color: white;
      font-family: Arial, sans-serif;
      
      justify-content: center;
      align-items: center;
      margin: 20px;
      display: flex;
      gap: 20px;
    }

    .box {
      background-color: #2a2a2a;
      padding: 40px 20px;
      border-radius: 10px;
      text-align: center;
      width: 120px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
      cursor: pointer;
    }

    .label {
      margin-top: 10px;
      font-size: 18px;
    }

    .location {
        background-color: #2a2a2a;
        color: #fff;
        padding: 10px 10px;
        border-radius: 10px;
        text-align: center;
        width: 330px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
        cursor: pointer;
        margin: 20px auto; /* Tengah secara horizontal */
    }

    /* lampu */
    .lampu {
      display: flex;
      justify-content: center;
      align-items: center;
      
    }
    .switch {
      margin: 10px;
      margin-left: 40px;
      
    --line: #E8EBFB;
    --dot: #275EFE;
    --circle: #D3D4EC;
    --background: #fff;
    --duration: .3s;
    --text: #9EA0BE;
    --shadow: 0 1px 3px #{rgba(#00093D, .08)};
    
    cursor: pointer;
    position: relative;
    &:before {
        content: '';
        width: 60px;
        height: 32px;
        border-radius: 16px;
        background: var(--background);
        position: absolute;
        left: 0;
        top: 0;
        box-shadow: var(--shadow);
    }
    input {
        display: none;
        & + div {
            position: relative;
            &:before,
            &:after {
                --s: 1;
                content: '';
                position: absolute;
                height: 4px;
                top: 14px;
                width: 24px;
                background: var(--line);
                transform: scaleX(var(--s));
                transition: transform var(--duration) ease;
            }
            &:before {
                --s: 0;
                left: 4px;
                transform-origin: 0 50%;
                border-radius: 2px 0 0 2px;
            }
            &:after {
                left: 32px;
                transform-origin: 100% 50%;
                border-radius: 0 2px 2px 0;
            }
            span {
                padding-left: 60px;
                line-height: 28px;
                color: var(--text);
                &:before {
                    --x: 0;
                    --b: var(--circle);
                    --s: 4px;
                    content: '';
                    position: absolute;
                    left: 4px;
                    top: 4px;
                    width: 24px;
                    height: 24px;
                    border-radius: 50%;
                    box-shadow: inset 0 0 0 var(--s) var(--b); 
                    transform: translateX(var(--x));
                    transition: box-shadow var(--duration) ease, transform var(--duration) ease;
                    }
                    &:not(:empty) {
                        padding-left: 68px;
                    }
                }
            }
            &:checked {
                & + div {
                    &:before {
                        --s: 1;
                    }
                    &:after {
                        --s: 0;
                    }
                    span {
                        &:before {
                            --x: 28px;
                            --s: 12px;
                            --b: var(--dot);
                        }
                    }
                }
            }
          }
        }

    /* bar jarak */
    :root{
            --num: 0;
            /* fungsinya sebagai nilai default suhu */
        }

    .bar_container {
      width: 50%;
      min-height: 30ch;
      display: flex;
      justify-content: center;  /* Menyusun konten secara horizontal di tengah */
      align-items: center;     /* Menyusun konten secara vertikal di tengah */
      flex-wrap: wrap;
      gap: 80px 100px;
      overflow: hidden;
      position: absolute;      /* Posisi absolute agar bisa ditempatkan sesuai keinginan */
      left: 50%;               /* Menyusun di tengah secara horizontal */
      transform: translateX(-50%); /* Geser ke kiri sebesar 50% dari lebar kontainer */
    }

        .bar_box {
        position: relative;
        width: 240px;
        height: 300px;
    
        justify-content: center;
        align-items: center;
        }

        .bar_box::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 20px;
        height: 100%;
        filter: blur(1px);
        z-index: 1;
        }

        .bar_box::after {
        content: '';
        position: absolute;
        top: 1px;
        right: -1px;
        width: 20px;
        height: 100%;
        filter: blur(1px);
        z-index: 1;
        }

        .bar_box .shadow {
        position: absolute;
        width: 100%;
        height: 100%;
        }

        .bar_box .shadow::before {
        content: '';
        position: absolute;
        top: 0;
        left: calc(100% + 5px);
        width: 100%;
        height: 200%;
        background: linear-gradient(rgba(0,0,0,0.075), transparent);
        transform: skewX(45deg);
        }

        .bar_box .shadow::after {
        content: '';
        position: absolute;
        bottom: -200%;
        left: calc(100% + 15px);
        width: 100%;
        height: 200%;
        background: linear-gradient(rgba(0,0,0,0.075), transparent);
        transform: skewX(45deg);
        }

        .bar_box .bar_content {
        position: relative;
        width: 100%;
        height: 100%;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        }

        .bar_box .bar_content .percent {
        position: relative;
        width: 150px;
        height: 150px;
        }

        .bar_box .bar_content .percent::before {
        content: attr(data-text);
        position: absolute;
        inset: 20px;
        background: #555;
        border-radius: 50%;
        display: flex;
        justify-content: center;
        align-items: center;
        color: #fff;
        font-size: 1.5rem;
        letter-spacing: 0.1rem;
        text-transform: uppercase;
        }

        .bar_box .bar_content .percent svg {
        position: relative;
        width: 150px;
        height: 150px;
        transform: rotate(270deg);
        }

        .bar_box .bar_content .percent svg circle {
        width: 100%;
        height: 100%;
        fill: transparent;
        stroke-width: 3;
        stroke: rgba(0,0,0,0.05);
        transform: translate(5px, 5px);
        }

        .bar_box .bar_content .percent svg circle:nth-child(2) {
        stroke: #555;
        stroke-dasharray: 440;
        stroke-dashoffset: calc(440 - (440 * var(--num)) / 100);
        opacity: 0;
        animation: fadeIn 1s linear forwards;
        animation-delay: 2.5s;
        }

        @keyframes fadeIn {
        0% {
            opacity: 0;
        }
        100% {
            opacity: 1;
        }
        }

        .bar_box .bar_content .percent .bar_dot {
        position: absolute;
        inset: 5px;
        z-index: 10;
        animation: animateDot 2s linear forwards;
        }

        @keyframes animateDot {
        0% {
            transform: rotate(0deg);
        }
        100% {
            transform: rotate(calc(3.6deg * var(--num)));
        }
        }

        .bar_box .bar_content .percent .bar_dot::before {
        content: '';
        position: absolute;
        top: -7px;
        left: 50%;
        transform: translateX(-50%);
        width: 14px;
        height: 14px;
        background: #555;
        border-radius: 50%;
        }

        .bar_box .bar_content .bar_number {
        position: relative;
        inset: 0;
        opacity: 0;
        animation: fadeIn 1s linear forwards;
        animation-delay: 2s;
        }

        .bar_box .bar_content .bar_number h2 {
        font-size: 2rem;
        color: #555;
        }

        .bar_box .bar_content .bar_number h2 span {
        font-weight: 300;
        font-size: 1.5rem;
        }

  </style>
</head>
<body>

  <div class="wrapper">
    <div class="typing-demo">
        Internet_Of_Thing.
    </div>
  </div>

  <figure class="fir-image-figure">

    <a class="fir-imageover" rel="noopener" target="_blank" href="https://twitter.com/_davideast">
      <img class="fir-author-image fir-clickcircle" src="https://fir-rollup.firebaseapp.com/de-sm.jpg" alt="David East - Author">
      <div class="fir-imageover-color"></div>
      <img class="fir-imageover-image fir-clickcircle" src="https://www.speccorporation.com/wp-content/uploads/2019/12/iot-circle.png" />
    </a>
  
    <figcaption>
      <div class="fig-author-figure-title">Abdul Fajar Septiawan</div>
      <div class="fig-author-figure-title">SMK AL-FALAH BANDUNG</div>
      <div class="fig-author-figure-title">Rekayasa Perangkat Lunak &#8212; 12 K2</div>
    </figcaption>
  </figure>

  <hr color="#fff" size="3%">
  
  <div class="boxWeather">
    <div class="weatherIcon" id="weatherIcon">
        <i class=""></i>
    </div>
  </div>
  <div class="weather">
    <div class="box">
      <div class="temperature" id="tempID">Cool</div>
    </div>
    <div class="box">
      <div class="weatherCondition" id="conditionID">Warm</div>
    </div>
    <div class="box">
        <div class="humidity" id="humidityID">Cool</div>
      </div>
  </div>
  <div class="location"><h2>Coblong, Bandung</h1></div>
  
  
  <hr color="#fff" size="3%">

  <div class="lampu">             
    <label class="switch">
      <input type="checkbox" onclick="toggleLED(1)" %CHECKBOX1%  id="checkbox1">
      <div>
          <span>Lampu 1</span>
      </div>
    </label>
    <label class="switch">
      <input type="checkbox" onclick="toggleLED(2)" %CHECKBOX2%  id="checkbox2">
      <div>
          <span>Lampu 2</span>
      </div>
    </label>
    <label class="switch">
      <input type="checkbox" onclick="toggleLED(3)" %CHECKBOX3%  id="checkbox3">
      <div>
          <span>Lampu 3</span>
      </div>
    </label>
  </div>

  <hr color="#fff" size="3%">

  <div class="bar_container">
    <div class="bar_box">
      <div class="bar_shadow"></div>
      <div class="bar_content">
        <div class="percent" data-text="Jarak" style="--num: 50">
          <div class="bar_dot"></div>
          <svg>
            <circle cx="70" cy="70" r="70"></circle>
            <circle cx="70" cy="70" r="70"></circle>
          </svg>
        </div>
        <div class="bar_number">
          <h2 id="percentage"><span>cm</span></h2>
        </div>
      </div>
    </div>
  </div>

  <!-- Config Firebase -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script type="module">
    import { initializeApp } from  "https://www.gstatic.com/firebasejs/11.2.0/firebase-app.js";
    import { getDatabase, ref, set, onValue } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-database.js";

    const firebaseConfig = {
    apiKey: "AIzaSyANG3EutJQ4Xx7t_YbkoyLqrHRpR5lVMoE",
    authDomain: "ukk12-k2.firebaseapp.com",
    databaseURL: "https://ukk12-k2-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "ukk12-k2",
    storageBucket: "ukk12-k2.firebasestorage.app",
    messagingSenderId: "815476436643",
    appId: "1:815476436643:web:f34221c159e9c870d6d916"
  };

    
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const ledRef = ref(db, 'dataLED');
    const dhtRef = ref (db, 'dataDHT');
    const ultrasonicRef = ref (db, 'dataJarak');
    
    
    let jarakValue = 80;
    let temperature = 60;
    let humidity = 80;

    onValue(dhtRef, (snapshot) =>{
        if (snapshot.exists()) {
            const data = snapshot.val();
            temperature = parseFloat(data.temperature).toFixed(2);
            humidity = data.humidity;

            console.log("Temperature updated:", temperature);
            console.log("Humidity updated:", humidity);

            updateWeatherInfo(temperature, humidity);
        } else {
            console.log("No data available for DHT sensor :", temperature);
        }
    }, (error) => {
        console.log("Error reeading DHT data:", error);
    });


    onValue(ultrasonicRef, (snapshot) => {
        if (snapshot.exists()) {
        const data = snapshot.val();
        jarakValue = data.distance;

        console.log("Distance updated:", jarakValue);
        
        // perbarui nilai --num dalam css
        const barPercentElement = document.querySelector(".percent");
        barPercentElement.style.setProperty("--num", jarakValue);

        const percentageElement = document.getElementById("percentage");
        percentageElement.textContent = `${jarakValue} cm`;
    } else {
        console.log("No data available for Ultrasonic sensor");
        }
    }, (error) => {
        console.error("error reading ultrasonik data:", error);
    });
    
    function updateWeatherCondition(tempValue){
        const conditionElement = document.getElementById("conditionID");
            
            if (tempValue < 25){
                conditionElement.textContent = "Dingin";
            } else if (tempValue >= 25 && tempValue < 30){
                conditionElement.textContent = "Medium";        
            } else if (tempValue >= 30 && tempValue < 100){
                conditionElement.textContent = "Panas";
            } else {
                conditionElement.textContent = "Error";
            }
        }

    //buat ganti kelembapan, suhu dan gambar
    function updateWeatherInfo(tempValue, humidityValue) {
    const temperatureElement = document.getElementById("tempID");
    const humidityElement = document.getElementById("humidityID");
    const iconElement = document.getElementById("weatherIcon");

    // Update suhu
    temperatureElement.innerHTML = `<span>${tempValue}&deg;</span>`;
    
    // Update kelembapan
    humidityElement.textContent = `${humidityValue}%`;

    // Tentukan ikon cuaca berdasarkan kelembapan
    let iconClass = "wi wi-na";  // default icon
    if (humidityValue < 30) {
        iconClass = "wi wi-hot";  // icon panas
    } else if (humidityValue >= 30 && humidityValue < 50) {
        iconClass = "wi wi-cloudy";  // icon mendung
    } else if (humidityValue >= 50 && humidityValue < 75) {
        iconClass = "wi wi-day-haze";  // icon kabut
    } else if (humidityValue >= 75 && humidityValue < 100) {
        iconClass = "wi wi-rain";  // icon hujan
    }
    iconElement.innerHTML = `<i class="${iconClass}"></i>`;

    // Update kondisi cuaca berdasarkan suhu
    updateWeatherCondition(tempValue);
}

    updateWeatherInfo(temperature, humidity);

    // MENGAMBAIL DATA LED DARI FIREBASE
  onValue(ledRef, (snapshot) => {
    if (snapshot.exists()) {
      const data = snapshot.val();
        Object.keys(data).forEach((key, index) => {
          document.getElementById(`checkbox${index + 1}`).checked = data[key] === 1;
        });
        console.log("LED status updated", Object.values(data));
      }
    });

    

    window.toggleLED = () => {
      const ledState = [1, 2, 3].map(index => document.getElementById (`checkbox${index}`).checked ? 1:0);
      
      set(ledRef,{
        led1:ledState[0],
        led2:ledState[1],
        led3:ledState[2]
      }).then(()=> console.log ("led status updated"))
      .catch(()=> console.log ("led eRAWR to updated"));
    };
</script>
</body>
</html>
